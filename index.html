<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>OFC Starter – PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f766e">

  <link rel="manifest" href="./manifest.json">
  <link rel="icon" href="./icons/icon-192.png">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #f8fafc;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .app {
      max-width: 480px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      background: #020617;
    }

    header {
      padding: 16px 20px 8px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    main {
      flex: 1;
      padding: 0 16px 10px;
      overflow-y: auto;
    }

    .page { display: none; padding-bottom: 14px; }
    .page.active { display: block; }

    h2 {
      margin-top: 0;
      margin-bottom: 14px;
      font-size: 20px;
    }

    .nav {
      display: flex;
      background: #020617;
      border-top: 1px solid #1e293b;
    }

    .nav button {
      flex: 1;
      padding: 10px 0 12px;
      font-size: 14px;
      border: none;
      background: transparent;
      color: #94a3b8;
      cursor: pointer;
    }

    .nav button.active {
      color: #0ea5e9;
      border-top: 3px solid #0ea5e9;
    }

    .card {
      background: #0f172a;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.45);
    }

    /* === VENTES === */

    .sales-card small.helper {
      display: block;
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .product {
      background: #111827;
      padding: 8px;
      border-radius: 14px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.15s ease, background 0.15s ease;
    }

    .product img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      border-radius: 10px;
      display: block;
    }

    .product span {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: #e5e7eb;
    }

    .product small {
      display: block;
      font-size: 12px;
      color: #93c5fd;
      margin-top: 2px;
    }

    .product.clicked {
      transform: scale(0.94);
      background: #1f2937;
    }

    .sale-form {
      margin-top: 4px;
    }

    .sale-form label {
      display: block;
      font-size: 13px;
      margin-top: 8px;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .sale-form input,
    .sale-form select {
      width: 100%;
      padding: 9px 10px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #f9fafb;
      font-size: 14px;
    }

    #btn-add-vente {
      margin-top: 12px;
      width: 100%;
      padding: 10px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #0284c7, #0ea5e9);
      color: #fff;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.15s ease;
    }

    #btn-add-vente:hover {
      transform: scale(1.02);
      background: linear-gradient(90deg, #0369a1, #0284c7);
    }

    .sales-list {
      margin-top: 14px;
    }

    .sale-item {
      padding: 10px 0;
      border-bottom: 1px solid #1e293b;
      font-size: 14px;
    }

    .sale-item-main {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }

    .sale-item-main span.desc {
      color: #e5e7eb;
    }

    .sale-item-main span.amount {
      font-weight: 600;
      color: #f9fafb;
    }

    .sale-item-meta {
      font-size: 12px;
      color: #9ca3af;
    }

    /* === DÉPENSES === */

    .expense-card {
      background: #0f172a;
      padding: 20px;
      border-radius: 14px;
      max-width: 420px;
      margin: 0 auto 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.45);
    }

    .expense-card h3 {
      margin-top: 0;
      margin-bottom: 18px;
      text-align: center;
      font-size: 18px;
    }

    .expense-card label {
      display: block;
      font-size: 14px;
      margin-bottom: 6px;
      color: #e2e8f0;
    }

    .expense-card input {
      width: 100%;
      padding: 11px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #f9fafb;
      margin-bottom: 14px;
      font-size: 15px;
    }

    #btn-add-depense {
      width: 100%;
      padding: 11px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, #0284c7, #0ea5e9);
      color: #fff;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: 0.15s ease;
    }

    #btn-add-depense:hover {
      transform: scale(1.02);
      background: linear-gradient(90deg, #0369a1, #0284c7);
    }

    .expense-list {
      max-width: 420px;
      margin: 0 auto;
    }

    .expense-item {
      padding: 12px;
      background: #0f172a;
      border-radius: 10px;
      margin-bottom: 10px;
      border: 1px solid #1f2937;
      color: #e5e7eb;
      font-size: 14px;
    }

    /* === RÉSUMÉ === */

    .resume-card {
      background: #0f172a;
      border-radius: 18px;
      padding: 20px;
      max-width: 440px;
      margin: 10px auto 0;
      box-shadow: 0 10px 25px rgba(0,0,0,0.45);
    }

    .resume-card h2 {
      margin-top: 0;
      margin-bottom: 18px;
      text-align: center;
      font-size: 20px;
    }

    .resume-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      font-size: 14px;
      color: #e2e8f0;
    }

    .resume-row strong {
      color: #f9fafb;
    }

    .resume-row.final strong {
      font-size: 16px;
      color: #38bdf8;
    }

    .resume-card hr {
      border: 0;
      border-top: 1px solid #1f2937;
      margin: 12px 0;
    }

    @media (max-width: 480px) {
      header { padding-left: 12px; }
      main { padding: 0 12px 8px; }
    }

    /* ===== Layout Ventes avec 3 zones ===== */

    .sales-container {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    
    /* ===== Produits en scroll horizontal ===== */

    .products-scroll {
      overflow-x: auto;
      overflow-y: hidden;
      padding: 10px 2px;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
    
    .product-row {
      display: inline-flex;
      gap: 12px;
    }
    
    .product {
      display: inline-block;
      width: 120px;
      flex-shrink: 0;
      background: #111827;
      padding: 8px;
      border-radius: 14px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.15s ease, background 0.15s ease;
    }
    
    .product img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .product span {
      display: block;
      margin-top: 6px;
      font-size: 13px;
      color: #e5e7eb;
    }
    
    .product small {
      display: block;
      font-size: 12px;
      color: #93c5fd;
      margin-top: 2px;
    }

    
    /* Formulaire stable */
    .sale-form {
      background: #0f172a;
      padding: 14px;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      position: relative;
    }
    
    /* Liste des ventes scrollable */
    .sales-list-scroll {
      max-height: 260px;
      overflow-y: auto;
      padding-right: 6px;
      margin-top: 4px;
      border-top: 1px solid #1e293b;
    }

    /* Effet zoom tactile */
    .product:active {
      transform: scale(0.92);
    }
    
    /* Scroll horizontal intelligent */
    .products-scroll {
      overflow-x: auto;
      overflow-y: hidden;
      padding-bottom: 8px;
      white-space: nowrap;
      scroll-snap-type: x mandatory;
    }
    
    .product-row {
      display: inline-flex;
      gap: 12px;
    }
    
    .product {
      scroll-snap-align: start;
      transition: transform 0.12s ease, background 0.12s ease;
    }
    
  </style>
</head>
<body>
<div class="app">
  <header>
    <h1>OFC Starter</h1>
  </header>

  <main>
    <!-- VENTES -->
    <section id="page-ventes" class="page active">
      <h2>Ventes</h2>
    
      <div class="sales-container">
    
        <!-- Scroll Produits --><div class="products-scroll">
        <div class="product-row">
      
          <div class="product" data-name="Chaussure homme" data-price="15000">
            <img src="./products/man_shoes.webp" alt="">
            <span>Chaussure homme</span>
            <small>15 000 FCFA</small>
          </div>
      
          <div class="product" data-name="Escarpin femme" data-price="20000">
            <img src="./products/woman_shoes.jpeg" alt="">
            <span>Escarpin femme</span>
            <small>20 000 FCFA</small>
          </div>
      
          <div class="product" data-name="Sac homme" data-price="15000">
            <img src="./products/man_bag.webp" alt="">
            <span>Sac homme</span>
            <small>15 000 FCFA</small>
          </div>
      
          <div class="product" data-name="Parfum homme" data-price="20000">
            <img src="./products/man_perfum.webp" alt="">
            <span>Parfum homme</span>
            <small>20 000 FCFA</small>
          </div>
      
          <div class="product" data-name="Sac femme" data-price="18000">
            <img src="./products/woman_bag.webp" alt="">
            <span>Sac femme</span>
            <small>18 000 FCFA</small>
          </div>
      
          <div class="product" data-name="Parfum femme" data-price="25000">
            <img src="./products/woman_parfum.webp" alt="">
            <span>Parfum femme</span>
            <small>25 000 FCFA</small>
          </div>
      
        </div>
      </div>

    
        <!-- Formulaire stable -->
        <div class="sale-form">
          <label>Date</label>
          <input type="date" id="vente-date">
    
          <label>Description / Client</label>
          <input type="text" id="vente-desc">
    
          <label>Montant (FCFA)</label>
          <input type="number" id="vente-montant">
    
          <label>Mode de paiement</label>
          <select id="vente-mode">
            <option value="Cash">Cash</option>
            <option value="Mobile Money">Mobile Money</option>
            <option value="Autre">Autre</option>
          </select>
    
          <button id="btn-add-vente">Ajouter la vente</button>
        </div>
    
        <!-- Liste scrollable des ventes -->
        <div class="sales-list-scroll">
          <div id="sales-list"></div>
        </div>
    
      </div>
    </section>

    <!-- DÉPENSES -->
    <section id="page-depenses" class="page">
      <h2>Dépenses</h2>
    
      <div class="expense-card">
        <h3>Ajouter une dépense</h3>
    
        <label>Montant (FCFA)</label>
        <input id="depense-montant" type="number" placeholder="Ex : 1500">
    
        <label>Description (optionnel)</label>
        <input id="depense-desc" type="text" placeholder="Ex : Transport">
    
        <button id="btn-add-depense">Ajouter la dépense</button>
      </div>
    
      <!-- Liste scrollable des dépenses -->
      <div class="expense-list" style="max-height:260px; overflow-y:auto; padding-right:6px;">
        <div id="expense-list"></div>
      </div>
    </section>

    <!-- RÉSUMÉ -->
    <section id="page-resume" class="page">
      <h2>Résumé</h2>
      <div class="resume-card">
        <h2>Calcul automatique</h2>

        <div class="resume-row"><span>Total ventes :</span><strong id="res-ventes">0 FCFA</strong></div>
        <div class="resume-row"><span>Total dépenses :</span><strong id="res-depenses">0 FCFA</strong></div>

        <hr>

        <div class="resume-row"><span>Bénéfice brut :</span><strong id="res-benefice">0 FCFA</strong></div>
        <div class="resume-row"><span>IGS (5%) :</span><strong id="res-igs">0 FCFA</strong></div>
        <div class="resume-row"><span>CAC (10% de l'IGS) :</span><strong id="res-cac">0 FCFA</strong></div>

        <hr>

        <div class="resume-row"><span>Total précompte :</span><strong id="res-precompte">0 FCFA</strong></div>
        <div class="resume-row final"><span>Solde net :</span><strong id="res-solde">0 FCFA</strong></div>
      </div>
    </section>
  </main>

  <nav class="nav">
    <button id="btn-ventes" class="active">Ventes</button>
    <button id="btn-depenses">Dépenses</button>
    <button id="btn-resume">Résumé</button>
  </nav>

</div>

<script>
  // ---------- Navigation ----------
  const pages = {
    ventes: document.getElementById("page-ventes"),
    depenses: document.getElementById("page-depenses"),
    resume: document.getElementById("page-resume"),
  };

  const buttons = {
    ventes: document.getElementById("btn-ventes"),
    depenses: document.getElementById("btn-depenses"),
    resume: document.getElementById("btn-resume"),
  };

  function show(page) {
    Object.values(pages).forEach(p => p.classList.remove("active"));
    Object.values(buttons).forEach(b => b.classList.remove("active"));
    pages[page].classList.add("active");
    buttons[page].classList.add("active");
    if (page === "resume") calculerResume();
  }

  buttons.ventes.onclick = () => show("ventes");
  buttons.depenses.onclick = () => show("depenses");
  buttons.resume.onclick = () => show("resume");

  // ---------- Utilitaires ----------
  function todayISO() {
    const d = new Date();
    const m = String(d.getMonth() + 1).padStart(2, "0");
    const day = String(d.getDate()).padStart(2, "0");
    return `${d.getFullYear()}-${m}-${day}`;
  }

  function formatMoney(v) {
    return (v || 0).toLocaleString("fr-FR") + " FCFA";
  }

  // ---------- VENTES : nouvelle logique ----------
  let ventes = JSON.parse(localStorage.getItem("ofc_ventes_v3") || "[]");

  const venteDateEl = document.getElementById("vente-date");
  const venteDescEl = document.getElementById("vente-desc");
  const venteMontantEl = document.getElementById("vente-montant");
  const venteModeEl = document.getElementById("vente-mode");
  const btnAddVente = document.getElementById("btn-add-vente");
  const salesList = document.getElementById("sales-list");

  // date par défaut = aujourd'hui
  venteDateEl.value = todayISO();

  function saveVentes() {
    localStorage.setItem("ofc_ventes_v3", JSON.stringify(ventes));
  }

  function renderVentes() {
    salesList.innerHTML = "";
    ventes.slice().reverse().forEach(v => {
      const div = document.createElement("div");
      div.className = "sale-item";
      div.innerHTML = `
        <div class="sale-item-main">
          <span class="desc">${v.description || "Sans description"}</span>
          <span class="amount">${formatMoney(v.montant)}</span>
        </div>
        <div class="sale-item-meta">
          ${v.date || ""} — ${v.mode || ""}
        </div>
      `;
      salesList.appendChild(div);
    });
  }

  // Clic produit -> préremplit formulaire
  document.querySelectorAll(".product").forEach(prod => {
    prod.addEventListener("click", () => {
      const name = prod.dataset.name || "";
      const price = Number(prod.dataset.price || "0") || "";
  
      venteDescEl.value = name;
      venteMontantEl.value = price;
      venteModeEl.value = "Cash";
      if (!venteDateEl.value) venteDateEl.value = todayISO();
  
      // Effet tactile
      if (navigator.vibrate) navigator.vibrate(8);
  
      prod.classList.add("clicked");
      setTimeout(() => prod.classList.remove("clicked"), 120);
    });
  });


  // Bouton ajouter la vente
  btnAddVente.addEventListener("click", () => {
    const date = venteDateEl.value || todayISO();
    const desc = venteDescEl.value.trim();
    const montant = Number(venteMontantEl.value);

    if (!montant || montant <= 0) {
      alert("Veuillez saisir un montant valide.");
      return;
    }

    const vente = {
      id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
      date,
      description: desc || "Vente",
      montant,
      mode: venteModeEl.value || "Cash",
      ts: Date.now()
    };

    ventes.push(vente);
    saveVentes();
    renderVentes();
    calculerResume();

    // reset partiel : on garde la date et le mode
    venteDescEl.value = "";
    venteMontantEl.value = "";
  });

  // ---------- DÉPENSES ----------
  let depenses = JSON.parse(localStorage.getItem("ofc_depenses") || "[]");

  const montantInput = document.getElementById("depense-montant");
  const descInput = document.getElementById("depense-desc");
  const btnAddDepense = document.getElementById("btn-add-depense");
  const expenseList = document.getElementById("expense-list");

  function saveDepenses() {
    localStorage.setItem("ofc_depenses", JSON.stringify(depenses));
  }

  function renderDepenses() {
    expenseList.innerHTML = "";
    depenses.slice().reverse().forEach(d => {
      const item = document.createElement("div");
      item.className = "expense-item";
      item.innerHTML =
        `<strong>${formatMoney(d.montant)}</strong> — ${d.desc || "Sans description"}`;
      expenseList.appendChild(item);
    });
  }

  btnAddDepense.addEventListener("click", () => {
    const montant = Number(montantInput.value);
    const desc = descInput.value.trim();

    if (!montant || montant <= 0) {
      alert("Veuillez entrer un montant valide.");
      return;
    }

    depenses.push({
      montant,
      desc: desc || "",
      ts: Date.now()
    });

    saveDepenses();
    renderDepenses();
    calculerResume();

    montantInput.value = "";
    descInput.value = "";
  });

  // ---------- RÉSUMÉ ----------
  function calculerResume() {
    const ventesLS = JSON.parse(localStorage.getItem("ofc_ventes_v3") || "[]");
    const depensesLS = JSON.parse(localStorage.getItem("ofc_depenses") || "[]");

    const totalVentes = ventesLS.reduce((s, v) => s + (v.montant || 0), 0);
    const totalDepenses = depensesLS.reduce((s, d) => s + (d.montant || 0), 0);

    const benefice = totalVentes - totalDepenses;

    const igs = benefice > 0 ? benefice * 0.05 : 0;    // 5% du bénéfice
    const cac = igs * 0.10;                            // 10% de l'IGS
    const precompte = igs + cac;
    const solde = benefice - precompte;

    document.getElementById("res-ventes").textContent = formatMoney(totalVentes);
    document.getElementById("res-depenses").textContent = formatMoney(totalDepenses);
    document.getElementById("res-benefice").textContent = formatMoney(benefice);
    document.getElementById("res-igs").textContent = formatMoney(igs);
    document.getElementById("res-cac").textContent = formatMoney(cac);
    document.getElementById("res-precompte").textContent = formatMoney(precompte);
    document.getElementById("res-solde").textContent = formatMoney(solde);
  }

  // ---------- Init ----------
  renderVentes();
  renderDepenses();
  calculerResume();

  // ---------- Service Worker ----------
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", function () {
      navigator.serviceWorker.register("./service-worker.js")
        .then(reg => console.log("SW enregistré:", reg.scope))
        .catch(err => console.error("Erreur SW:", err));
    });
  }

</script>
  
</body>
</html>
